# 카테고리 기능 설정 가이드

대시보드 옆 사이드바에서 **과목/카테고리를 자유롭게 추가·수정·삭제**하려면, Supabase에 카테고리용 테이블을 한 번만 만들어 주어야 합니다.

## 1. Supabase 대시보드 열기

1. [Supabase](https://supabase.com)에 로그인합니다.
2. 사용 중인 프로젝트를 선택합니다.

## 2. SQL 실행하기

1. 왼쪽 메뉴에서 **SQL Editor**를 클릭합니다.
2. **New query**를 눌러 새 쿼리 창을 엽니다.
3. 아래 SQL **전체**를 복사해 붙여넣은 뒤 **Run**을 클릭합니다.

```sql
-- Categories (과목/카테고리) for organizing notes
CREATE TABLE IF NOT EXISTS categories (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id TEXT NOT NULL,
  name TEXT NOT NULL,
  sort_order INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_categories_user_id ON categories(user_id);

ALTER TABLE categories ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own categories"
  ON categories FOR SELECT
  USING (
    auth.uid()::text = user_id OR
    user_id LIKE 'anonymous_%' OR
    auth.role() = 'anon'
  );

CREATE POLICY "Users can insert their own categories"
  ON categories FOR INSERT
  WITH CHECK (
    auth.uid()::text = user_id OR
    user_id LIKE 'anonymous_%' OR
    auth.role() = 'anon'
  );

CREATE POLICY "Users can update their own categories"
  ON categories FOR UPDATE
  USING (
    auth.uid()::text = user_id OR
    user_id LIKE 'anonymous_%' OR
    auth.role() = 'anon'
  )
  WITH CHECK (
    auth.uid()::text = user_id OR
    user_id LIKE 'anonymous_%' OR
    auth.role() = 'anon'
  );

CREATE POLICY "Users can delete their own categories"
  ON categories FOR DELETE
  USING (
    auth.uid()::text = user_id OR
    user_id LIKE 'anonymous_%' OR
    auth.role() = 'anon'
  );

-- Add category_id to notes
ALTER TABLE notes ADD COLUMN IF NOT EXISTS category_id UUID REFERENCES categories(id) ON DELETE SET NULL;

CREATE INDEX IF NOT EXISTS idx_notes_category_id ON notes(category_id);
```

## 3. 실행 후 확인

- **Success** 메시지가 나오면 설정이 완료된 것입니다.
- 앱을 새로고침하면 사이드바에서 카테고리를 **추가·이름 수정·삭제**할 수 있습니다.
- 카테고리를 삭제하면, 해당 카테고리에 묶여 있던 노트는 **미분류**로 이동합니다.

## 4. 에러가 날 때

| 메시지 / 상황 | 해결 방법 |
|---------------|-----------|
| `function uuid_generate_v4() does not exist` | 쿼리 **맨 위**에 다음 한 줄을 추가한 뒤 다시 실행합니다.<br>`CREATE EXTENSION IF NOT EXISTS "uuid-ossp";` |
| `relation "notes" does not exist` | 먼저 노트용 테이블이 만들어져 있어야 합니다. 노트 기능 설정 가이드를 따라 `notes` 테이블을 만든 후, 위 카테고리 SQL을 실행하세요. |
| 정책/인덱스가 이미 있다는 오류 | `IF NOT EXISTS` 때문에 테이블·인덱스는 보통 괜찮습니다. 정책 이름이 같아서 오류가 나면, Supabase **Table Editor**에서 해당 테이블의 정책을 확인한 뒤 중복된 정책만 수동으로 정리한 다음, 필요한 부분만 다시 실행해 보세요. |

---

이 파일(`카테고리_설정_가이드.md`)은 프로젝트 루트에 있으며, 내용은 `supabase/migrations/006_categories.sql`과 동일합니다.
